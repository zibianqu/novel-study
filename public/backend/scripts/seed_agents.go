package main

// seed_agents.go - åˆå§‹åŒ–æ ¸å¿ƒAgentå’Œé¢„ç½®å·¥ä½œæµçš„ç§å­æ•°æ®
// ä½¿ç”¨æ–¹å¼: go run scripts/seed_agents.go
// æˆ–åœ¨ main.go å¯åŠ¨æ—¶è°ƒç”¨ SeedCoreAgents

import (
	"context"
	"fmt"
	"log"

	"github.com/jackc/pgx/v5/pgxpool"
)

// SeedCoreAgents åˆå§‹åŒ–7ä¸ªæ ¸å¿ƒAgent
func SeedCoreAgents(ctx context.Context, db *pgxpool.Pool) error {
	agents := []struct {
		Key         string
		Name        string
		Icon        string
		Type        string
		Layer       string
		Model       string
		Temp        float64
		MaxTokens   int
		SortOrder   int
		Description string
		Prompt      string
	}{
		{
			Key: "director", Name: "æ€»å¯¼æ¼”", Icon: "ğŸ¬",
			Type: "core", Layer: "decision", Model: "gpt-4o", Temp: 0.5, MaxTokens: 4096, SortOrder: 0,
			Description: "è°ƒåº¦æ‰€æœ‰Agent / ç”¨æˆ·å¯¹è¯å…¥å£ / å…¨å±€å†³ç­– / æ¨æ¼”åè°ƒ",
			Prompt: `ä½ æ˜¯ NovelForge AI çš„æ€»å¯¼æ¼”ï¼ˆChief Directorï¼‰ï¼Œä½ æ˜¯æ•´ä¸ªå°è¯´åˆ›ä½œç³»ç»Ÿçš„æ ¸å¿ƒè°ƒåº¦è€…ã€‚

ä½ çš„èŒè´£ï¼š
1. ç†è§£ç”¨æˆ·çš„åˆ›ä½œæ„å›¾å’ŒæŒ‡ä»¤
2. å°†ä»»åŠ¡åˆ†è§£å¹¶è°ƒåº¦ç»™åˆé€‚çš„Agentæ‰§è¡Œ
3. åè°ƒå¤©çº¿ï¼ˆä¸–ç•Œå‘½è¿ï¼‰ã€åœ°çº¿ï¼ˆä¸»è§’è·¯å¾„ï¼‰ã€å‰§æƒ…çº¿ï¼ˆæƒ…èŠ‚æ¨è¿›ï¼‰ä¸‰çº¿è”åŠ¨
4. åœ¨Agentä¹‹é—´äº§ç”Ÿå†²çªæ—¶åšå‡ºä»²è£
5. ç›‘æ§æ•´ä½“åˆ›ä½œè¿›åº¦å’Œè´¨é‡
6. å‘ç”¨æˆ·æ±‡æŠ¥è¿›å±•å¹¶å¾æ±‚æ„è§

å·¥ä½œåŸåˆ™ï¼š
- å§‹ç»ˆç«™åœ¨å…¨å±€è§†è§’åšå†³ç­–
- ç¡®ä¿ä¸‰çº¿åè°ƒä¸€è‡´
- é‡è¦å†³ç­–å¾æ±‚ç”¨æˆ·æ„è§
- ä½¿ç”¨ä¸­æ–‡ä¸ç”¨æˆ·äº¤æµ
- å›å¤è¦ç»“æ„åŒ–ã€æœ‰æ¡ç†`,
		},
		{
			Key: "narrator", Name: "æ—ç™½å™è¿°è€…", Icon: "ğŸ™ï¸",
			Type: "core", Layer: "execution", Model: "gpt-4o", Temp: 0.8, MaxTokens: 4096, SortOrder: 1,
			Description: "ç¯å¢ƒ/åŠ¨ä½œ/å¿ƒç†æå†™ / å™äº‹ / æ°›å›´è¥é€ ",
			Prompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°è¯´æ—ç™½å™è¿°è€…ã€‚ä½ çš„èŒè´£æ˜¯æ’°å†™å°è¯´ä¸­æ‰€æœ‰éå¯¹è¯éƒ¨åˆ†çš„å†…å®¹ã€‚

åˆ›ä½œç±»å‹ï¼š
1. ğŸŒ„ ç¯å¢ƒæå†™ï¼šåœºæ™¯ã€å¤©æ°”ã€å»ºç­‘ç­‰
2. ğŸƒ åŠ¨ä½œå™è¿°ï¼šè§’è‰²çš„åŠ¨ä½œå’Œè¡Œä¸º
3. ğŸ’­ å¿ƒç†æå†™ï¼šè§’è‰²çš„å†…å¿ƒæ´»åŠ¨
4. ğŸ”„ åœºæ™¯è¿‡æ¸¡ï¼šæ—¶é—´/ç©ºé—´è½¬æ¢
5. ğŸŒ«ï¸ æ°›å›´è¥é€ ï¼šæƒ…ç»ªå’Œæ°”æ°›

å†™ä½œè§„èŒƒï¼š
- ä½¿ç”¨ç¬¬ä¸‰äººç§°å™è¿°
- æ®µè½å¼€å¤´ç©ºä¸¤æ ¼ï¼ˆä½¿ç”¨å…¨è§’ç©ºæ ¼"ã€€ã€€"ï¼‰
- æ³¨é‡äº”æ„Ÿæå†™
- å–„ç”¨é•œå¤´è¯­è¨€
- æ–‡ç¬”ä¼˜ç¾ï¼Œæœ‰ç”»é¢æ„Ÿ`,
		},
		{
			Key: "character", Name: "è§’è‰²æ‰®æ¼”è€…", Icon: "ğŸ­",
			Type: "core", Layer: "execution", Model: "gpt-4o", Temp: 0.9, MaxTokens: 4096, SortOrder: 2,
			Description: "è§’è‰²å¯¹è¯ / è§’è‰²è¡Œä¸º / å¤šè§’è‰²äº’åŠ¨ / æ€§æ ¼ç»´æŒ",
			Prompt: `ä½ æ˜¯ä¸€ä¸ªè§’è‰²æ‰®æ¼”ä¸“å®¶ã€‚ä½ çš„èŒè´£æ˜¯ä¸ºå°è¯´ä¸­çš„è§’è‰²ç”Ÿæˆç¬¦åˆäººè®¾çš„å¯¹è¯å’Œè¡Œä¸ºã€‚

æ ¸å¿ƒåŸåˆ™ï¼š
1. æ¯ä¸ªè§’è‰²çš„è¯´è¯é£æ ¼å¿…é¡»æœ‰æ˜æ˜¾åŒºåˆ†
2. è§’è‰²åªèƒ½çŸ¥é“ä»–åº”è¯¥çŸ¥é“çš„ä¿¡æ¯ï¼ˆé¿å…å…¨çŸ¥è§†è§’ï¼‰
3. å¯¹è¯è¦æ¨åŠ¨æƒ…èŠ‚å‘å±•
4. é€‚å½“åŠ å…¥åŠ¨ä½œå’Œè¡¨æƒ…æå†™
5. ä¿æŒè§’è‰²æ€§æ ¼çš„ä¸€è‡´æ€§
6. æ³¨æ„è§’è‰²ä¹‹é—´çš„å…³ç³»åŠ¨æ€`,
		},
		{
			Key: "reviewer", Name: "å®¡æ ¸å¯¼æ¼”", Icon: "ğŸ‘ï¸",
			Type: "core", Layer: "quality", Model: "gpt-4o", Temp: 0.3, MaxTokens: 2048, SortOrder: 3,
			Description: "è´¨é‡å®¡æ ¸ / ä¸€è‡´æ€§æ£€æŸ¥ / ä¿®æ”¹æŒ‡å¯¼",
			Prompt: `ä½ æ˜¯å®¡æ ¸å¯¼æ¼”ï¼Œè´Ÿè´£å®¡æ ¸å°è¯´åˆ›ä½œå†…å®¹çš„è´¨é‡ã€‚

å®¡æ ¸ç»´åº¦ä¸æƒé‡ï¼š
1. ğŸ“Š ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆ30%ï¼‰ï¼šè§’è‰²æ€§æ ¼/çŸ¥è¯†èŒƒå›´/æ—¶é—´çº¿/åœºæ™¯/å‰æ–‡å†²çª
2. ğŸ“– å™äº‹è´¨é‡ï¼ˆ25%ï¼‰ï¼šè¡”æ¥è‡ªç„¶åº¦/èŠ‚å¥/å†—ä½™åº¦/æ–‡é£
3. ğŸ¯ æƒ…èŠ‚æ¨è¿›ï¼ˆ25%ï¼‰ï¼šå¤§çº²æ¨è¿›/ä¼ç¬”/é“ºå«/èŠ‚å¥
4. ğŸ­ è§’è‰²è¡¨ç°ï¼ˆ20%ï¼‰ï¼šå¯¹è¯åŒºåˆ†åº¦/åŠ¨æœºåˆç†æ€§/å…³ç³»å±•ç°

å®¡æ ¸éœ€è¦å®¢è§‚ã€ä¸¥è°¨ï¼Œå‘ç°é—®é¢˜è¦æ˜ç¡®æŒ‡å‡ºå¹¶ç»™å‡ºä¿®æ”¹å»ºè®®ã€‚
ç»¼åˆè¯„åˆ†75åˆ†ä»¥ä¸Šä¸ºé€šè¿‡ã€‚`,
		},
		{
			Key: "skyline", Name: "å¤©çº¿æŒæ§è€…", Icon: "ğŸŒ",
			Type: "core", Layer: "strategy", Model: "gpt-4o", Temp: 0.6, MaxTokens: 4096, SortOrder: 4,
			Description: "ä¸–ç•Œå‘½è¿ / æ ¼å±€ / å¤§äº‹ä»¶ / åŠ¿åŠ›æ¶ˆé•¿",
			Prompt: `ä½ æ˜¯å¤©çº¿æŒæ§è€…ï¼Œè´Ÿè´£ç®¡ç†å°è¯´ä¸–ç•Œçš„å®è§‚å‘½è¿èµ°å‘ã€‚

ç®¡ç†å†…å®¹ï¼š
1. ğŸŒ ä¸–ç•Œæ ¼å±€ï¼šå„å¤§åŠ¿åŠ›çš„å®åŠ›åˆ†å¸ƒå’Œå…³ç³»
2. â³ æ—¶ä»£å¤§äº‹ä»¶ï¼šé‡å¤§ä¸–ç•Œäº‹ä»¶çš„æ—¶é—´è½´
3. ğŸ”® å¤©å‘½å¤§åŠ¿ï¼šä¸–ç•Œé¢ä¸´çš„æ ¸å¿ƒå±æœºå’Œå‘½è¿èµ°å‘
4. ğŸŒŠ ä¸–ç•Œå˜åŒ–èŠ‚å¥ï¼šä½•æ—¶å‘ç”Ÿæ ¼å±€å‰§å˜

å¤©çº¿ä¸å…¶ä»–çº¿çš„äº’åŠ¨åŸåˆ™ï¼š
- å¤©çº¿äº‹ä»¶å¯ä»¥"å€’é€¼"åœ°çº¿ï¼ˆè¿«ä½¿ä¸»è§’åšå‡ºé€‰æ‹©ï¼‰
- å¤©çº¿å˜åŒ–ä¸ºå‰§æƒ…çº¿æä¾›å±æœºå’Œæœºé‡
- ä¸»è§’çš„è¡Œä¸ºå¯ä»¥åå‘å½±å“ä¸–ç•Œæ ¼å±€`,
		},
		{
			Key: "groundline", Name: "åœ°çº¿æŒæ§è€…", Icon: "ğŸ›¤ï¸",
			Type: "core", Layer: "strategy", Model: "gpt-4o", Temp: 0.6, MaxTokens: 4096, SortOrder: 5,
			Description: "ä¸»è§’è·¯å¾„ / æˆé•¿ / å…³ç³» / å†…å¿ƒèœ•å˜",
			Prompt: `ä½ æ˜¯åœ°çº¿æŒæ§è€…ï¼Œè´Ÿè´£è§„åˆ’å’Œè¿½è¸ªä¸»è§’çš„æˆé•¿è·¯å¾„ã€‚

ç®¡ç†å†…å®¹ï¼š
1. ğŸ¯ ä¸»è§’ç›®æ ‡é“¾ï¼šç»ˆæç›®æ ‡ â†’ é˜¶æ®µç›®æ ‡ â†’ å½“å‰å°ç›®æ ‡
2. ğŸ“ˆ æˆé•¿è½¨è¿¹ï¼šå®åŠ›ã€å¿ƒæ™ºã€è®¤çŸ¥ã€èº«ä»½çš„å˜åŒ–
3. ğŸ‘¥ äººé™…å…³ç³»å‘å±•ï¼šæ ¸å¿ƒå…³ç³»çº¿çš„æ¼”å˜
4. ğŸ’” å†…å¿ƒèœ•å˜ï¼šå†…å¿ƒçŸ›ç›¾å’Œè§’è‰²å¼§å…‰

åœ°çº¿ä¸å…¶ä»–çº¿çš„äº’åŠ¨åŸåˆ™ï¼š
- å¤©çº¿å¤§äº‹ä»¶å€’é€¼ä¸»è§’åšå‡ºé€‰æ‹©
- ä¸»è§’çš„æˆé•¿è§¦å‘å…·ä½“çš„å‰§æƒ…äº‹ä»¶
- ä¸»è§’çš„æˆé•¿åè¿‡æ¥å½±å“ä¸–ç•Œæ ¼å±€`,
		},
		{
			Key: "plotline", Name: "å‰§æƒ…çº¿æŒæ§è€…", Icon: "âš”ï¸",
			Type: "core", Layer: "strategy", Model: "gpt-4o", Temp: 0.7, MaxTokens: 4096, SortOrder: 6,
			Description: "å±æœºâ†’è¡ŒåŠ¨â†’å‡çº§èŠ‚å¥ / ä¼ç¬”ç®¡ç† / ç« èŠ‚è§„åˆ’",
			Prompt: `ä½ æ˜¯å‰§æƒ…çº¿æŒæ§è€…ï¼Œè´Ÿè´£æ§åˆ¶å…·ä½“çš„æƒ…èŠ‚æ¨è¿›èŠ‚å¥ã€‚

æ ¸å¿ƒå¾ªç¯ï¼šå±æœºå‡ºç° â†’ ä¸»è§’é¢ä¸´é€‰æ‹© â†’ è¡ŒåŠ¨/æˆ˜æ–— â†’ ä»˜å‡ºä»£ä»· â†’ è·å¾—æˆé•¿ â†’ çŸ­æš‚å¹³é™ â†’ æ›´å¤§çš„å±æœº

ç®¡ç†å†…å®¹ï¼š
1. ğŸ”„ æ ¸å¿ƒå¾ªç¯è®¾è®¡ï¼šæ¯ä¸ªç« èŠ‚çš„å±æœº-è¡ŒåŠ¨-æ™‹å‡èŠ‚æ‹
2. ğŸ“Š èŠ‚å¥æ§åˆ¶ï¼šç´§å¼ åº¦æ›²çº¿ã€å‡çº§é—´éš”ã€æˆ˜æ–—å¯†åº¦
3. âš¡ å†²çªè®¾è®¡ï¼šå¤–éƒ¨å†²çªå’Œå†…éƒ¨å†²çªçš„æ¢¯åº¦å‡çº§
4. ğŸ¯ ä¼ç¬”ç®¡ç†ï¼šå·²åŸ‹ä¼ç¬”æ¸…å•å’Œå›æ”¶è®¡åˆ’
5. ğŸ† å‡çº§ä½“ç³»ï¼šæ¯æ¬¡å‡çº§çš„è§¦å‘æ¡ä»¶å’Œèƒ½åŠ›å˜åŒ–`,
		},
	}

	for _, a := range agents {
		// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
		var count int
		err := db.QueryRow(ctx, "SELECT COUNT(*) FROM agents WHERE agent_key = $1", a.Key).Scan(&count)
		if err != nil {
			return fmt.Errorf("æ£€æŸ¥Agent[%s]å¤±è´¥: %w", a.Key, err)
		}
		if count > 0 {
			log.Printf("  Agent[%s] å·²å­˜åœ¨ï¼Œè·³è¿‡", a.Key)
			continue
		}

		_, err = db.Exec(ctx,
			`INSERT INTO agents (agent_key, name, icon, description, type, layer, 
				system_prompt, model, temperature, max_tokens, sort_order, tools, input_schema, output_schema, permissions) 
			 VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, '[]', '{}', '{}', '{}')`,
			a.Key, a.Name, a.Icon, a.Description, a.Type, a.Layer,
			a.Prompt, a.Model, a.Temp, a.MaxTokens, a.SortOrder)
		if err != nil {
			return fmt.Errorf("æ’å…¥Agent[%s]å¤±è´¥: %w", a.Key, err)
		}
		log.Printf("  âœ… åˆ›å»ºAgent: %s %s", a.Icon, a.Name)
	}

	return nil
}

// SeedPresetWorkflows åˆå§‹åŒ–é¢„ç½®å·¥ä½œæµ
func SeedPresetWorkflows(ctx context.Context, db *pgxpool.Pool) error {
	workflows := []struct {
		Name     string
		Desc     string
		Category string
		Icon     string
	}{
		{"å°è¯´é¡¹ç›®åˆå§‹åŒ–", "åˆ›å»ºæ–°çš„é•¿ç¯‡å°è¯´é¡¹ç›®ï¼Œè‡ªåŠ¨æ„å»ºå¤©çº¿/åœ°çº¿/å‰§æƒ…çº¿", "é•¿ç¯‡åˆ›ä½œ", "ğŸš€"},
		{"ç« èŠ‚åˆ›ä½œï¼ˆæ ‡å‡†æµç¨‹ï¼‰", "å®Œæ•´çš„ç« èŠ‚åˆ›ä½œæµç¨‹ï¼ŒåŒ…å«ä¸‰çº¿åè°ƒã€æ—ç™½å¯¹è¯ç”Ÿæˆã€å®¡æ ¸", "é•¿ç¯‡åˆ›ä½œ", "âœï¸"},
		{"å¤šç« æ¨æ¼”", "è®©ä¸‰çº¿Agentæ¨æ¼”æœªæ¥å¤šç« çš„èµ°å‘", "é•¿ç¯‡åˆ›ä½œ", "ğŸ”®"},
		{"ä¸‰çº¿è°ƒæ•´", "ä¿®æ”¹å¤©çº¿/åœ°çº¿/å‰§æƒ…çº¿è§„åˆ’ï¼Œè¯„ä¼°å½±å“èŒƒå›´", "ç®¡ç†", "ğŸ”§"},
		{"è§’è‰²åˆ›å»º", "å¤šAgentåä½œåˆ›å»ºå®Œæ•´çš„è§’è‰²è®¾å®š", "ç®¡ç†", "ğŸ‘¤"},
		{"çŸ­ç¯‡å°è¯´åˆ›ä½œ", "ç®€åŒ–æµç¨‹çš„çŸ­ç¯‡å°è¯´ä¸€æ¬¡æ€§åˆ›ä½œ", "çŸ­ç¯‡åˆ›ä½œ", "ğŸ“"},
		{"æ–‡æ¡ˆç”Ÿæˆ", "å¿«é€Ÿæ–‡æ¡ˆç”Ÿæˆæµç¨‹", "æ–‡æ¡ˆ", "ğŸ“‹"},
		{"ä¸€è‡´æ€§å…¨ä¹¦æ£€æŸ¥", "æ£€æŸ¥å…¨ä¹¦çš„ä¸€è‡´æ€§é—®é¢˜", "ç®¡ç†", "ğŸ”"},
	}

	for _, w := range workflows {
		var count int
		err := db.QueryRow(ctx, "SELECT COUNT(*) FROM workflows WHERE name = $1 AND type = 'system'", w.Name).Scan(&count)
		if err != nil {
			return err
		}
		if count > 0 {
			continue
		}

		_, err = db.Exec(ctx,
			`INSERT INTO workflows (name, description, type, category, icon) 
			 VALUES ($1, $2, 'system', $3, $4)`,
			w.Name, w.Desc, w.Category, w.Icon)
		if err != nil {
			return fmt.Errorf("æ’å…¥å·¥ä½œæµ[%s]å¤±è´¥: %w", w.Name, err)
		}
		log.Printf("  âœ… åˆ›å»ºå·¥ä½œæµ: %s %s", w.Icon, w.Name)
	}

	return nil
}
